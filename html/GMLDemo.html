<!DOCTYPE html>
<html>
	<head>
		<title> Gamify My Life </title>
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
		<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
		<script src="../JavaScript/home.js"></script>
		<script src="../JavaScript/newTask.js"></script>
		<script>

			// Use instead of $(document).ready();
			$(document).on('pageinit', function() {

				// HACK! I need to find a better way to clear local storage 
				// for debugging purposes
				// BUG! This code is somehow wiping my local storage values 
				// when home screen is displayed. But only sometimes.
				// Solution: Once the logic for deleting a task is done, 
				// we won't need this hack code anymore.
				/*
				var clear = localStorage.getItem("1");
				console.log(clear);
				if (clear != true)
				{
					localStorage.clear();
					clear=true;
					localStorage.setItem("1",clear);
				}
				console.log(clear);			
				*/

				var checkboxChecked = function() {
				    if ($("#completedCheckbox").is(":checked"))
				    {
						// Add credits to your bank
						console.log("checkbox has been checked!");

						var taskToBeDeleted = this.getAttribute("data-task-name");
						// Store this value into localStorage for later...
						localStorage.setItem("taskToBeDeleted", taskToBeDeleted);

						// On clicking of the completed checkbox, we want to
						// pop up a dialog for confirmation.
						$.mobile.changePage( "#confirmCompletionDialog", { role: "dialog" } );
				    }
				};
				 
				$( "input[type=checkbox]" ).on( "change", checkboxChecked );

				$("#completedTaskYes").click(function (e) {
					console.log("Yes, we completed our task");

					var taskToBeDeleted = localStorage.getItem("taskToBeDeleted");
					removeTaskFromTaskList(taskToBeDeleted);

					$.mobile.changePage( "#home");
				});

				var removeTaskFromTaskList = function( taskToBeDeleted) {
					if (localStorage.getItem("taskListArray")) {
			
						// Parse the stringified array object 
						var listOfTasks = JSON.parse(localStorage["taskListArray"]);

						// Delete the entry in listOfTasks where name matches
						// taskToBeDeleted

						$(listOfTasks).each( function(idx,task) { 
							console.log("task name is: "+task["name"]);
							if (task["name"] == taskToBeDeleted)
								console.log("Task found, delete this entry!")
						});
					}
				}
			
			}); // End of Document onPageInit 
		</script>
	</head>
	<body>
		<div data-role="page" data-theme="b" id="home">

			<div data-role="header" data-theme="b">
				<h1>Gamify My Life!</h1>

				<div data-role="navbar" data-theme="a">
				</div>
			</div><!-- /header -->

			<div data-role="content" data-theme="a">
				<h3> Task List </h3>
				<ul data-role="listview" data-filter=false id="taskList">
				</ul>
				
				<!--
				<ol data-role="listview" data-filter=true id="swipelist">
				
					<li id="page1"><a href="#firstLink">Do Laundry</a></li>
					<li id="page2"><a href="#secondLink">Go Grocery Shopping</a></li>
					<li id="page3"><a href="#thirdLink">Pay Bills</a></li>
				<ol>
				-->
				
				

			</div><!-- /content -->

			<div data-role="footer" data-theme="b" data-position="fixed">
				<nav data-role="navbar">
					<ul>		
						<li><a href="#home"  data-icon="home">Home</a></li>
						<li><a href="#newTask"  data-icon="edit">New Task</a></li>
  						<li><a href="#credits" data-icon="star">Credits</a></li>
					</ul>
				</nav>
			</div><!--/footer -->
		</div><!--/page -->


		<div data-role="page" data-theme="b" id="firstLink">

			<div data-role="header" data-theme="b">
				<h1>Edit Task</h1>

				<div data-role="navbar" data-theme="a">
				</div>
			</div><!-- /header -->

			<div data-role="content" data-theme="a">
				<h1>Do Laundry</h1>
				<label for="textarea-a">Notes:</label>
				<label><input type="checkbox" name="checkbox-0" id="myCheckbox" /> Completed </label>

				<a id='lnkDialog' href="#dialog" data-rel="dialog" data-transition="pop" style='display:none;'></a>

			</div><!-- /content -->

			<div data-role="footer" data-theme="b" data-position="fixed">
				<nav data-role="navbar">
					<ul>		
						<li><a href="#home"  data-icon="home">Home</a></li>
						<li><a href="#newTask"  data-icon="edit">New Task</a></li>
  						<li><a href="#credits" data-icon="star">Credits</a></li>
					</ul>
				</nav>
			</div><!--/footer-->
		</div><!--/page -->


		<div data-role="page" data-theme="b" id="newTask">

			<div data-role="header" data-theme="b">
				<h1>Create Task</h1>

				<div data-role="navbar" data-theme="a">
				</div>
			</div><!-- /header -->

			<div data-role="content" data-theme="a">
				<div data-role="fieldcontain">
		  			<label for="taskName">Task Name:</label>
		  			<input type="text" name="name" id="taskName" value="" />
				</div>
				<button id="saveButton">Save</button>  
			</div><!-- /content -->

			<div data-role="footer" data-theme="b" data-position="fixed">
				<nav data-role="navbar">
					<ul>		
						<li><a href="#home"  data-icon="home">Home</a></li>
						<li><a href="#newTask"  data-icon="edit">New Task</a></li>
  						<li><a href="#credits" data-icon="star">Credits</a></li>
					</ul>
				</nav>
			</div><!--/footer-->
		</div><!--/page -->


		<div data-role="page" data-theme="b" id="credits">

			<div data-role="header" data-theme="b">
				<h1>Your Credits</h1>

				<div data-role="navbar" data-theme="a">
				</div>
			</div><!-- /header -->

			<div data-role="content" data-theme="a">
				Currently, you have 0 credits.
			</div><!-- /content -->

			<div data-role="footer" data-theme="b" data-position="fixed">
				<nav data-role="navbar">
					<ul>		
						<li><a href="#home"  data-icon="home">Home</a></li>
						<li><a href="#newTask"  data-icon="edit">New Task</a></li>
  						<li><a href="#credits" data-icon="star">Credits</a></li>
					</ul>
				</nav>
			</div><!--/footer-->
		</div><!--/page -->


		<div data-role="page" data-theme="b" id="confirmCompletionDialog">
			<div data-role="header" data-theme="b">
				<h1>Are you sure?</h1>
			</div><!-- /header -->
			<div data-role="content">
			<p> Are you sure you completed the task?</p>
				<button id="completedTaskYes">Yes</button>
				<button id="completedTaskNo">No</button>
			</div><!-- /content -->

		</div><!--/page -->

	</body>
</html>

